# apiVersion: v1
# kind: Namespace
# metadata:
#   name: test-busybox
# ---
# apiVersion: v1
# kind: Pod
# metadata:
#   name: {{ .Values.busybox }}
#   namespace: {{ .Values.ns }}
# spec:
#   containers:
#     - image: busybox
#       command:
#         - sleep
#         - "3600"
#       imagePullPolicy: IfNotPresent
#       name: busybox
#   restartPolicy: Always

# ---
{{- range .Values.busyboxes }}
apiVersion: v1
kind: Pod
metadata:
  name: {{ . }}
  namespace: {{ $.Values.ns }}
  labels:
    app: {{ . }}
spec:
  containers:
    - image: busybox
      name: busybox
      command:
        - sleep
        - "3600"
      imagePullPolicy: IfNotPresent
  restartPolicy: Always
---
  apiVersion: v1
kind: Service
metadata:
  name: {{ . }}-svc
  namespace: {{ $.Values.ns }}
spec:
  selector:
    app: {{ . }}
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
{{- end }}